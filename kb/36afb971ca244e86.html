<html>
<head>
  <title>»спользование указателей на целое</title>
  <meta http-equiv="Content-Type" content="text/html; charset=windows-1251" />
  <link type="text/css" href="css/css.css" rel="stylesheet" />
  <link type="text/css" href="css/sh.css" rel="stylesheet" />
  <script language="javascript" src="js/shInit.js"></script>
  <script language="javascript" src="js/shCore.js"></script>
  <script language="javascript" src="js/shBrushDelphi.js"></script>
  <script language="javascript" src="js/shBrushSql.js"></script>
</head>
<body>
<div id="layout">
<div id="header">
  <div id="logo"><img id="logo" src="img/logo.png" /></div>
  <div id="navigation">
    <p id="navigation">
      <a class="navigation" onclick="prev();" href="#">ѕредыдуща€</a><br />
      <a class="navigation" onclick="up();" href="#">Ќаверх</a><br />
      <a class="navigation" onclick="next();" href="#">—ледующа€</a>
    </p>
  </div>
</div>
<div id="content">
<div id="explorer">DRKB Explorer</div>
  <h1 id="title">»спользование указателей на целое</h1>
<div id="date">01.01.2010</div>
<!-- Actual content start -->

<p>—начала вы должны создать тип:</p>
<pre name="code" class="delphi">
Type Pinteger : ^Integer;
 
Var MyPtr : Pinteger;
</pre>

<p>ћне кажетс€, что в начале вы использовали плохой пример, имеет смысл использовать 32-битный указатель дл€ 16-битной величины или распредел€ть 10 байт дл€ переменной. </p>

<p>Pascal позвол€ет вам использовать методы NEW и DISPOSE, которые автоматически распредел€ют и освобождают правильные размеры блока. </p>

<p>Ќапример:</p>
<pre name="code" class="delphi">
NEW(MyPtr) = GetMem(MyPtr, Sizeof(MyPtr))
</pre>

<p>¬озможно, вы захотите подсчитать количество целочесленных переменных. ¬ этом случае ознакомьтесь с возможност€ми TList. ѕока лучше используйте линейный массив (или указатель на первый элемент, чтобы вычислить их количество, достаточно разделить количество занимаемой массивом пам€ти на количество элементов). </p>

<p>ƒл€ полноты, это должно быть:</p>

<pre name="code" class="delphi">
NEW(MyPtr) = GetMem(MyPtr, SizeOf(MyPtr^));
</pre>

<p>SizeOf(MyPtr) всегда будет равен 4 байта, как 16-битный указатель. </p>

<p>≈сли € правильно разобралс€ в том, что вы хотите (динамический массив целых, количество элеметнов которого может быть известно только во врем€ выполнени€ приложени€), вы можете сделать так:</p>

<pre name="code" class="delphi">
Type
  pIntArr = ^IntArr;
  IntArr  = Array[1..1000] of Integer;
Var
  MyPtr : pIntArr;
Begin
  GetMem(MyPtr, 10); { 10 = SizeOf(Integer) * 5 !!)
  { MyPtr[2]:=1; }
  // &lt;&lt;&lt;&lt; «аполн€ем массив &gt;&gt;&gt;&gt;
  MyPtr[2]^:=1;
  FreeMem(MyPtr,10);
End;
</pre>

<p>“ехнологи€ похожа на ту, котора€ Delphi использует при работе с pchar. —интаксис очень похож:</p>

<pre name="code" class="delphi">
type
  intarray = array[0..20000] of integer;
 
procedure TForm1.Button1Click(Sender: TObject);
var
  xptr:  ^IntArray;
begin
  GetMem(xptr, 10);
  xptr^[idx] := 1;  { где idx от 0 до 4, поскольку мы
                      имеем 10 байте = 5 целых }
  FreeMem(xptr, 10);
end;
</pre>

<p>ќбратите внимание на то, в вам в действительности нет необходимости распредел€ть массив дл€ 20,000 элементов, но проверка диапазона Delphi не будет работать, если диапазон равен 20,000. (ѕредостережение будущим пользовател€м!) </p>
<p>¬з€то с <a href="http://delphiworld.narod.ru" target="_blank">http://delphiworld.narod.ru</a></p>
</div>
<!-- Actual content end -->
<hr />
<div id="footer">
<p>&copy; DRKB Library, 2010<br />–азработка и поддержка &mdash; <a href="http://www.drkb.ru/" target="_blank">Quadr0</a></p>
</div>
</div>
</body>
</html>
